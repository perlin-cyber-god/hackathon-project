from moviepy.editor import VideoFileClip
import speech_recognition as sr
import os

def video_to_text(video_path, output_txt_path=None):
    if output_txt_path is None:
        output_txt_path = os.path.splitext(video_path)[0] + ".txt"
    
    audio_path = os.path.splitext(video_path)[0] + ".wav"
    
    try:
        print("Extracting audio from video...")
        video = VideoFileClip(video_path)
        video.audio.write_audiofile(audio_path, codec='pcm_s16le')
        video.close()
        
        print("Transcribing audio to text...")
        recognizer = sr.Recognizer()
        with sr.AudioFile(audio_path) as source:
            recognizer.adjust_for_ambient_noise(source, duration=0.5)
            audio_data = recognizer.record(source)
        text = recognizer.recognize_google(audio_data)
        
        with open(output_txt_path, "w", encoding="utf-8") as f:
            f.write(text)
        
        print(f"✅ Transcription saved to {output_txt_path}")
        return text
    
    except Exception as e:
        print(f"❌ Error: {e}")
        return None
    finally:
        if os.path.exists(audio_path):
            os.remove(audio_path)

# Example
if __name__ == "__main__":
    video_file = "video.mp4"
    print(video_to_text(video_file))
